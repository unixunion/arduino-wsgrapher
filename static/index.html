<!DOCTYPE HTML>
<html>

<head>
	<script type="text/javascript">
  var dps = []; // dataPoints
	var xVal = 0;
	var yVal = 100;	
	var dataLength = 500; // number of dataPoints visible at any point
  var chart;
  
  
  var updateChart = function(x) {
    var yVal = Math.round( x );

  	dps.push({
  		x: xVal,
  		y: yVal
  	});
  	xVal++;
  
    //$('#log').append('<br>Chart #' + msg.data + ': ' + xVal + ' dps.length: ' + dps.length);
    console.log('<br>Chart #' + yVal + ': ' + xVal + ' dps.length: ' + dps.length);

  	if (dps.length > dataLength)
  	{
  		dps.shift();
  	}

  	chart.render();
  
};
  
  
	window.onload = function () {

		chart = new CanvasJS.Chart("chartContainer",{
			title :{
				text: "u/g cm3"
			},			
			data: [{
				type: "line",
				dataPoints: dps 
			}]
		});

		var updateInterval = 20;

	}
	</script>
  <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
	<script type="text/javascript" src="/js/canvasjs.min.js"></script>
  
  <script type="text/javascript" charset="utf-8">
          $(document).ready(function(){
              namespace = '/stream'; // change to an empty string to use the global namespace
              // the socket.io documentation recommends sending an explicit package upon connection
              // this is specially important when using the global namespace
              var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
              socket.on('connect', function() {
                  socket.emit('refresh', {data: 'hit me'});
              });
              
              socket.on('refresh data', function(msg) {
                console.log('refreshing data');
                
                var index;
                for	(index = 0; index < msg.data.length; index++) {
                    updateChart(msg.data[index]);
                }
              });
              
              // event handler for server sent data
              // the data is displayed in the "Received" section of the page
              socket.on('my response', function(msg) {
                  //$('#log').append('<br>Received #' + msg.count + ': ' + msg.data);
                  console.log('Received #' + msg.count + ': ' + msg.data);
                  updateChart(msg.data);
                  
              });
          });
      </script>
  
</head>
<body>
	<div id="chartContainer" style="height: 300px; width:100%;">
	</div>
  <div id="log"></div>
</body>
</html>